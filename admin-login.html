<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Login</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f9;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
  .container{width:320px;background:#fff;padding:20px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  h2{text-align:center;margin:0 0 14px}
  input,textarea{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:6px}
  button{width:100%;padding:10px;border:0;border-radius:6px;background:#2b3d34;color:#fff;cursor:pointer}
  .toggle{color:#007bff;text-align:center;margin-top:8px;cursor:pointer}
  .msg{height:18px;text-align:center;margin-top:8px;color:#d00}
</style>
</head>
<body>
<div class="container">
  <h2 id="title">Admin Login</h2>

  <form id="loginForm">
    <input id="loginEmail" type="email" placeholder="Email" required />
    <input id="loginPassword" type="password" placeholder="Password" required />
    <button type="submit">Login</button>
  </form>

  <form id="registerForm" style="display:none;margin-top:8px">
    <input id="registerUsername" placeholder="Username" required />
    <input id="registerEmail" type="email" placeholder="Email" required />
    <input id="registerPassword" type="password" placeholder="Password" required />
    <button id="registerBtn" type="button">Create Account</button>
  </form>

  <form id="resetForm" style="display:none;margin-top:8px">
    <input id="resetEmail" type="email" placeholder="Email" required />
    <input id="resetPassword" type="password" placeholder="New Password" required />
    <button id="resetBtn" type="button">Reset Password</button>
  </form>

  <div class="toggle" id="toRegister">Create Account</div>
  <div class="toggle" id="toReset">Forgot Password?</div>
  <div class="toggle" id="toLogin" style="display:none">Back to Login</div>
  <div class="msg" id="msg"></div>
</div>

<script>
const API_URL = "https://hon-isyaku-bawa-na-abi-2025.onrender.com";
const msg = (t,err=true) => { const el=document.getElementById('msg'); el.style.color=err? '#d00':'#0a0'; el.textContent = t; setTimeout(()=>el.textContent='','6000') };

// toggle views
document.getElementById('toRegister').onclick = () => { show('register'); };
document.getElementById('toReset').onclick = () => { show('reset'); };
document.getElementById('toLogin').onclick = () => { show('login'); };

function show(which) {
  document.getElementById('loginForm').style.display = which==='login'?'block':'none';
  document.getElementById('registerForm').style.display = which==='register'?'block':'none';
  document.getElementById('resetForm').style.display = which==='reset'?'block':'none';
  document.getElementById('toRegister').style.display = which==='login'?'block':'none';
  document.getElementById('toReset').style.display = which==='login'?'block':'none';
  document.getElementById('toLogin').style.display = which==='login'?'none':'block';
}

// if token exists, verify quickly
(async function check() {
  const token = localStorage.getItem('adminToken');
  if (!token) return;
  try {
    const res = await fetch(`${API_URL}/api/admins/check`, {
      headers: { 'Authorization': 'Bearer ' + token }
    });
    const j = await res.json();
    if (j.loggedIn) {
      window.location.href = 'admindash.html';
    } else {
      // invalid token -> clear
      localStorage.removeItem('adminToken');
    }
  } catch(e){ /* ignore */ }
})();

// LOGIN
document.getElementById('loginForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  try {
    const res = await fetch(`${API_URL}/api/admins/login`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ email, password })
    });
    const j = await res.json();
    if (res.ok && j.token) {
      localStorage.setItem('adminToken', j.token);
      msg('Login successful', false);
      setTimeout(()=>window.location.href='admindash.html', 200);
    } else {
      msg(j.error || 'Login failed');
    }
  } catch (err) { msg('Server error'); }
});

// REGISTER
document.getElementById('registerBtn').addEventListener('click', async () => {
  const username = document.getElementById('registerUsername').value.trim();
  const email = document.getElementById('registerEmail').value.trim();
  const password = document.getElementById('registerPassword').value;
  if (!username || !email || !password) return msg('All fields required');
  try {
    const res = await fetch(`${API_URL}/api/admins/register`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ username, email, password })
    });
    const j = await res.json();
    if (res.ok) {
      msg('Account created', false);
      show('login');
    } else msg(j.error || 'Registration failed');
  } catch { msg('Server error'); }
});

// RESET
document.getElementById('resetBtn').addEventListener('click', async () => {
  const email = document.getElementById('resetEmail').value.trim();
  const newPassword = document.getElementById('resetPassword').value;
  if (!email || !newPassword) return msg('Email and new password required');
  try {
    const res = await fetch(`${API_URL}/api/admins/reset`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ email, newPassword })
    });
    const j = await res.json();
    if (res.ok) { msg('Password reset', false); show('login'); }
    else msg(j.error || 'Reset failed');
  } catch { msg('Server error'); }
});
</script>
</body>
</html>
